services:
  api-gateway:
    container_name: api-gateway
    image: doyts/watmarker-api-gateway
    build:
      context: .
      dockerfile: ./microservice/api_gateway/Dockerfile
    ports:
      - 8080:8080
    volumes:
      - ./microservice/api_gateway/.env:/.env
    depends_on:
      - watermark

  watermark:
    container_name: watermark-service
    image: doyts/watmarker-watermark
    build:
      context: .
      dockerfile: ./microservice/watermark_service/Dockerfile
    ports:
      - 6000:6000
    volumes:
      - ./microservice/watermark_service/.env:/.env

  web-app:
    container_name: web-app
    image: doyts/watmarker-web-app
    build:
      args:
        - VITE_API_BASE_URL=${VITE_API_BASE_URL}
      context: ./microservice/web_app
      dockerfile: prod.Dockerfile
    ports:
      - 3000:80
      - 3001:443
    depends_on:
      - api-gateway
